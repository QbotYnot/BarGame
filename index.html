<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buxton Bar Game</title>
<style>
body {
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 20px;
}
#header h1 { font-size: 36px; color: gold; }
#header p { font-size: 18px; }

#game {
  display: flex;
  gap: 40px;
  justify-content: center;
  margin: 20px auto;
}
.bar {
  background: #222;
  padding: 20px;
  border-radius: 12px;
  width: 300px;
  border: 3px solid #444;
}
.bar.active { border-color: gold; }
.stools-row {
  display: flex;
  justify-content: space-around;
  margin-top: 10px;
  flex-wrap: wrap;
  gap: 5px;
}
.stool { font-size: 32px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; opacity: 0.4; }
.stool.occupied { opacity: 1; transform: translateY(-5px); }

.neon-sign { font-size: 24px; color: #ff4da6; margin-bottom: 10px; opacity: 0.6; }
.neon-sign.on { opacity: 1; text-shadow: 0 0 5px #ff4da6,0 0 10px #ff69b4; }

#virginiaOverlay {
  position: fixed; inset: 0;
  background: crimson;
  display: none;
  align-items: center; justify-content: center;
  z-index: 9999;
}
#virginiaImage { max-width: 80%; max-height: 80%; opacity:0; transform: scale(0.5); }

@keyframes zoomInvert {
  0% { transform: scale(0.5); opacity:0; filter:none; }
  50% { transform: scale(1.2); opacity:1; filter: invert(100%); }
  100% { transform: scale(1); opacity:1; filter:none; }
}

#victoryOverlay {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background: linear-gradient(135deg, gold, #ff69b4);
  display:none; align-items:center; justify-content:center; flex-direction:column;
  z-index: 10000;
}
#victoryOverlay.show { display:flex; }
#victoryOverlay h1 { font-size: 36px; color:white; text-shadow:0 0 10px #fff,0 0 20px #ff0; }

#drawButton { padding:10px 20px; font-size:18px; margin:15px auto; display:block; cursor:pointer; }
#log { margin-top:15px; font-size:16px; }

#confettiCanvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:10001; }
</style>
</head>
<body>

<div id="setupScreen">
  <h2>Set up your game</h2>
  <label>Number of Players: 
    <select id="numPlayers">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
  </label>
  <div id="playerNames"></div>
  <button id="startGame">Start Game</button>
</div>


<div id="header">
  <h1>üç∫ Buxton Bar Game</h1>
  <p>Fill your bar with 7 stools before it's too late!</p>
</div>

<div id="game"></div>
<button id="drawButton">Draw Card</button>
<div id="log"></div>

<!-- Virginia overlay -->
<div id="virginiaOverlay">
  <img id="virginiaImage" src="VA.jpg" alt="Virginia">
</div>

<!-- Victory overlay -->
<div id="victoryOverlay">
  <h1 id="victoryText"></h1>
</div>

<!-- Glass smash audio -->
<audio id="glassSmash" src="glass-smash.mp3"></audio>

<!-- Confetti canvas -->
<canvas id="confettiCanvas"></canvas>

<script>
const setupScreen = document.getElementById("setupScreen");
const numPlayersSelect = document.getElementById("numPlayers");
const playerNamesDiv = document.getElementById("playerNames");
const startButton = document.getElementById("startGame");

numPlayersSelect.addEventListener("change", () => {
  const count = parseInt(numPlayersSelect.value);
  playerNamesDiv.innerHTML = "";
  for (let i = 0; i < count; i++) {
    const input = document.createElement("input");
    input.placeholder = `Player ${i+1} Name`;
    input.type = "text";
    playerNamesDiv.appendChild(input);
    playerNamesDiv.appendChild(document.createElement("br"));
  }
});

// Initialize name fields
numPlayersSelect.dispatchEvent(new Event("change"));

startButton.addEventListener("click", () => {
  const inputs = playerNamesDiv.querySelectorAll("input");
  players.length = 0; // Clear existing players

  inputs.forEach(input => {
    let name = input.value.trim() || "Player";
    players.push({ name, stools: 0, stoolEmojis: [] });
  });

  setupScreen.style.display = "none";
  gameDiv.style.display = "flex";
  drawButton.style.display = "block";
  render();
});



const MAX_STOOLS = 7;
const VIRGINIA_CHANCE = 0.1;
const players = [
];

let currentPlayer = 0;

const gameDiv = document.getElementById("game");
const logDiv = document.getElementById("log");
const drawButton = document.getElementById("drawButton");
const peopleEmojis = ["üßç","üßë‚Äçüç≥","üßë‚Äçüé§","üßë‚Äçüè´","üßë‚Äçüé®","üßë‚Äçüíª"];


function render() {
  gameDiv.innerHTML = "";
  players.forEach((p,i)=>{
    const bar = document.createElement("div");
    bar.className = "bar"+(i===currentPlayer?" active":"");
    let stoolsHTML = "";
for (let s = 0; s < MAX_STOOLS; s++) {
  if (s < p.stools) {
    // Use the emoji already stored for this stool
    stoolsHTML += `<div class="stool occupied">${p.stoolEmojis[s]}</div>`;
  } else {
    stoolsHTML += `<div class="stool">ü™ë</div>`;
  }
}

    bar.innerHTML = `<div class="neon-sign ${i===currentPlayer?"on":""}">${p.name}</div>
                     <div class="stools-row">${stoolsHTML}</div>`;
    gameDiv.appendChild(bar);
  });
}

function showVirginiaAnimation() {
  const overlay = document.getElementById("virginiaOverlay");
  const sound = document.getElementById("glassSmash");
  const img = document.getElementById("virginiaImage");
  sound.currentTime=0; sound.play();
  overlay.style.display="flex";
  img.style.animation="zoomInvert 1s forwards";
  setTimeout(()=>{
    overlay.style.display="none";
    img.style.animation="none";
  },1200);
}

function drawCard() {
  const player = players[currentPlayer];
  const isVirginia = Math.random() < VIRGINIA_CHANCE;

  if (isVirginia) {
    // Reset everything
    player.stools = 0;
    player.stoolEmojis = [];
    logDiv.innerText = `${player.name} drew VIRGINIA! All stools cleared!`;
    showVirginiaAnimation();
  } else {
    // Add one stool and a new emoji
    player.stools += 1;
    const newEmoji = peopleEmojis[Math.floor(Math.random() * peopleEmojis.length)];
    player.stoolEmojis.push(newEmoji);
    logDiv.innerText = `${player.name} drew a regular customer.`;

    // Check for win
    if (player.stools >= MAX_STOOLS) {
      const victoryOverlay = document.getElementById("victoryOverlay");
      const victoryText = document.getElementById("victoryText");
      victoryText.innerText = `YAY! ${player.name} made it through their shift without Big V!`;
      victoryOverlay.classList.add("show");
      drawButton.disabled = true;
      logDiv.innerText = "";
      startConfetti();
    }
  }

  // Next player's turn
  currentPlayer = (currentPlayer + 1) % players.length;
  render();
}


drawButton.addEventListener("click", drawCard);
render();

// ====== CONFETTI ======
const confettiCanvas = document.getElementById("confettiCanvas");
const ctx = confettiCanvas.getContext("2d");
let confettiPieces=[];

function resizeCanvas(){ confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function createConfetti(){
  confettiPieces=[];
  const colors=["#ff0","#ff69b4","#00ffff","#00ff00","#ffa500"];
  for(let i=0;i<150;i++){
    confettiPieces.push({x:Math.random()*confettiCanvas.width,
                         y:Math.random()*confettiCanvas.height-confettiCanvas.height,
                         r:Math.random()*6+4,
                         d:Math.random()*10+2,
                         color:colors[Math.floor(Math.random()*colors.length)],
                         tilt:Math.random()*10-10});
  }
}

function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiPieces.forEach(p=>{
    ctx.beginPath();
    ctx.lineWidth=p.r/2;
    ctx.strokeStyle=p.color;
    ctx.moveTo(p.x+p.tilt,p.y);
    ctx.lineTo(p.x+p.tilt,p.y+p.r);
    ctx.stroke();
  });
  updateConfetti();
}

function updateConfetti(){
  confettiPieces.forEach(p=>{
    p.y += Math.cos(p.d)+1+p.r/2;
    p.x += Math.sin(0.01)*2;
    if(p.y>confettiCanvas.height){ p.y=-10; p.x=Math.random()*confettiCanvas.width; }
  });
}

let confettiInterval;
function startConfetti(){
  createConfetti();
  confettiInterval = setInterval(drawConfetti,20);
  setTimeout(stopConfetti,5000);
}

function stopConfetti(){
  clearInterval(confettiInterval);
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
}
</script>

</body>
</html>

